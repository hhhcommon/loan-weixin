<!DOCTYPE html>
<html>
	<head>
	<META HTTP-EQUIV="pragma" CONTENT="no-cache">  
		<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">  
		<META HTTP-EQUIV="expires" CONTENT="0">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="format-detection" content="telephone=no,date=no,address=no">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>我的</title>
		<link rel="stylesheet" type="text/css" href="../css/base.css" />
		<link rel="stylesheet" type="text/css" href="../css/huiflex.css" />
		<link rel="stylesheet" type="text/css" href="../css/loadingm.css" />

		<style type="text/css">
			@font-face {
				font-family: "iconfont";
				src: url('../css/iconfont.ttf') format('truetype')/* chrome, firefox, opera, Safari, Android, iOS 4.2+*/
			}
			
			.iconfont {
				font-family: "iconfont" !important;
				font-size: 16px;
				font-style: normal;
				-webkit-font-smoothing: antialiased;
				-webkit-text-stroke-width: 0.2px;
				-moz-osx-font-smoothing: grayscale;
			}
			
			.icon {
				display: inline-block;
				min-width: 18px;
				height: 18px;
				color: #97acc1;
				margin-right: 5px;
			}
			
			.allbg {
				/*background:-webkit-gradient(linear, 0 0, 100% 100%, from(#2AF3CB),to(#2C8EF3));*/
				background: -webkit-linear-gradient(-50deg, rgba(42, 243, 178, 0.72), #2C90F2);
				height: 180px;
			}
			
			.font-num {
				font-family: helvetica, "Hiragino Sans GB", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif;
			}
			
			.cycle_data {
				height: 150px;
				width: 150px;
				border-radius: 150px;
				border: 10px solid white;
				text-align: center;
				color: white;
				margin: auto;
			}
			
			.liitem {
				padding: 15px;
				border-bottom: 1px solid #dbd9da;
			}
			.error{color: #fff;background: rgba(0,0,0,0.4);text-align: center;line-height: 50px;position: fixed;top: 0;left: 0;right: 0;bottom: 0;z-index: 100;}
			.error .error_msg{background: rgba(0,0,0,0.6);position: fixed;top: 35%;left: 20px;right: 20px;z-index: 100;border-radius: 5px;}


			.customer{
				background-image: url(../img/666830017191577610.png);
				background-size: 15px 15px;
				background-repeat: no-repeat;
			}


			.raiders{
				background-image: url(../img/670679769043048446.png);
				background-size: 15px 15px;
				background-repeat: no-repeat;
			}

			._hidden{
				visibility: hidden;

			}
		</style>
	</head>

	<body>

		<div id="" class="allbg" style="padding-top: 25px;">
			<div id="cycle_data" class="cycle_data hui-flex center">
				<div class="">
					<div class="" style="font-size: 25px;font-weight: bold;"><span id="" style="font-size: 14px;">￥</span><span id="quota">0</span> </div>
					<div class="" style="margin-top: 5px;">可分期额度</div>
				</div>

			</div>
		</div>
		<div class="" style="background: white;">
			<ul>
				<a href="javascript:void(0)">
					<li class="liitem">
						<span style="color:#333333;">
							<i class="icon iconfont">&#xe688;</i><span id="idcardlabel">我的银行卡</span>
						</span>
						<span id="idcardStatelabel" style="float: right;color: #999999;">
							 未认证 >
						</span>
					</li>
				</a>
				<a href="javascript:void(0)">
					<li class="liitem">
						<span style="color:#333333;">
							<i class="icon iconfont">&#xe60a;</i>常见问题
						</span>
						<span id="" style="float: right;color: #999999;">
							>
						</span>
					</li>
				</a>
				<a href="javascript:void(0)">
					<li class="liitem">
						<span style="color:#333333;">
							<i class="icon iconfont raiders"></i>分期攻略
						</span>
						<span id="" style="float: right;color: #999999;">
							 >
						</span>
					</li>
				</a>
				<a href="javascript:void(0)">
					<li class="liitem">
						<span style="color:#333333;">
							<i class="icon iconfont customer"></i>客服中心
						</span>
						<span id="" style="float: right;color: #999999;">
							 >
						</span>
					</li>
				</a>
				<a href="javascript:void(0)">
					<li class="liitem">
						<span style="color:#333333;">
							<i class="icon iconfont">&#xe6f7;</i>关于我们
						</span>
						<span id="" style="float: right;color: #999999;">
							 >
						</span>
					</li>
				</a>
				<a href="javascript:void(0)">
					<li class="liitem">
						<span style="color:#333333;">
							<i class="icon iconfont">&#xe6f7;</i>设置
						</span>
						<span id="" style="float: right;color: #999999;">
							 >
						</span>
					</li>
				</a>
			</ul>
		</div>

		<div id="myModal" class="loading-modal" style="display: none;">
			<!-- Modal content -->
			<div class="loading-modal-content">
				<img src="../img/default.svg" style="vertical-align: middle;width: 3em;margin-left: 1em;" />
				<span id="" style="vertical-align: middle;margin-left: 1em;color: #333;">
					数据加载中...
				</span>
			</div>
		</div>

		<div id="telPhone"></div>


		<script src="../js/fastclick.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/zepto.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/util_v1.4.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			var problemUrl;
			var aboutUrl;
			var authState="0";
			var customerPhone="";

			function configh() {
				$('#myModal').show();
				postSerData('/wechat/iden/api/configh.shtml', {
					"id": "wx"
				}, initConfigh, '车库城市');
				$('#myModal').hide();
			}

			function initConfigh(data) {
                var url="question_chewei_problem.html"+"?timeStamp="+getTimeStamp();
                if(localStorage.caiweiObj){
                    var cwobj = JSON.parse(localStorage.caiweiObj);
                    if(cwobj.cat=="10"){
                        url="question_credit_problem.html"+"?timeStamp="+getTimeStamp();
                    }
                }
                problemUrl = url;
				if(data.success) {
					aboutUrl = data.data.about;
				} else {
					error(data.message)
				}
			}

			function getQuota(tdata) {
				$('#myModal').show();
				postSerDataWithHeader('/wechat/borrow/api/getQuota.shtml', {
					"id": tdata.userId
				}, initQuota, '用户额度');
				$('#myModal').hide();
			}

			function initQuota(data) {
				if(data.success) {
					$('#quota').text(data.data.quota)
				} else {
					error(data.message)
				}
			}
			function initEvent(tdata, durl) { //tdata null 注册
				$('#cycle_data').click(function() {
					if(!tdata) {
					    if(durl.indexOf("?")!=-1){
					        durl+="&timeStamp="+getTimeStamp()
						}else{
                            durl+="?timeStamp="+getTimeStamp()
						}
						window.location.href = durl
					}
				});

				$('a').click(function() {
					if(!tdata) {
						window.location.href = durl;
						return;
					}
					var le = $("a").length;
					if (le ==6){
                        switch($(this).index()) {
                        case 0:
                            localStorage.page = "mine";
                            if(localStorage.caiweiObj){
                                var cwobj = JSON.parse(localStorage.caiweiObj);
                                if(cwobj.cat=="10"){
                                    window.location.href = "../iden/index.html"+"?timeStamp="+getTimeStamp();
                                }else{
                                    if(authState=="0"){
                                        return;
                                    }
                                    if(authState=="1"){
                                        window.location.href = "../iden/AuthenticationInfo.html"+"?timeStamp="+getTimeStamp();
                                    }else{
                                        window.location.href = "../iden/Authentication.html"+"?timeStamp="+getTimeStamp();
                                    }
                                }
                            }
                            break;
                        case 1:
                            if(problemUrl) {
                                window.location.href = problemUrl;
                            }
                            break;
                        case 4:
                            if(aboutUrl) {
                                window.location.href = aboutUrl;
                            }
                            break;
                        case 2:
                            var url="../guidance/cheweiyindao_wx.html"+"?timeStamp="+getTimeStamp();
                            if(localStorage.caiweiObj){
                                var cwobj = JSON.parse(localStorage.caiweiObj);
                                if(cwobj.cat=="10"){
                                    url="../guidance/xinyongyindao_wx.html"+"?timeStamp="+getTimeStamp();
                                }else{
                                    url="../guidance/cheweiyindao_wx.html"+"?timeStamp="+getTimeStamp();
                                }
                            }
                            window.location.href = url;
                            break;
                        case 3:
                            showCustomerModal();
                            break;
                        case 5:
                        	 window.location.href = "install.html?timeStamp="+getTimeStamp();
                            break;

                        default :
                            break;
                    }
				}

				});
			}

			function wxLogin(caiweiWx) {
				$('#myModal').show();
				setTimeout(function() {
					postSerData('/wechat/user/api/wxLogin.shtml', {
						openid: caiweiWx.openId,
						unionid: caiweiWx.unionId
					}, check, '微信登录');
					$('#myModal').hide();
				}, 200);

			}

			function getCheckWxUser() {
				$('#myModal').show();
				setTimeout(function() {
					postSerData('/wechat/user/api/checkWxUser.shtml', {
						query: GetQueryString("code")
					}, checkWxUser, '微信校验登录');
					$('#myModal').hide();
				}, 200);
			}
			

			function getAuthData(tdata) {
                setTimeout(function() {
                    postSerDataWithHeader('/wechat/iden/api/getAuth.shtml', {
                        "id": tdata.userId
                    }, function (rdata) {
						if(rdata.success){
						    var data=rdata.data;
						    if(data.bankCardState=="30"&&data.contactState=="30"&&data.phoneState=="30"&&data.idState=="30"){
						        authState="1";
								if(tdata.cat=="20"){
                                    $("#idcardStatelabel").text("已认证 >");
								}
							}else{
						        authState="2";
							}
						}

                    }, '初始化');
                }, 200);

            }

			function checkWxUser(data) {
				var login = data.login;
				var wxdata = data.wxdata;
				localStorage.caiweiWx = JSON.stringify(wxdata);
				check(login);
			}

			function check(login) {
				if(login.success) {
					localStorage.caiweiObj = JSON.stringify(login.data);
					var tdata = login.data;
					if(tdata.isLogin=="1"){
						if(tdata.cat == "0") {
							initEvent(false, "selectcat.html" + location.search);
						} else {
							$('#myModal').show();
							setTimeout(function() {
								initEvent(tdata);
								getQuota(tdata);
								configh();
								getAuthData(tdata);
								initCustomerModal();
								$('#myModal').hide();
							}, 200);
						}

						if(tdata.cat == "10") {
							$("#idcardlabel").text("身份认证");
							$("#idcardStatelabel").text(">");
						}
						}else{
							 window.location.href = "../login/login.html?timeStamp="+getTimeStamp();
						}
					} else {
						window.location.href = "../login/login.html?timeStamp="+getTimeStamp();
					}
			}

			$(function() {
				var code = GetQueryString("code");
				if(localStorage.caiweicode && localStorage.caiweicode == code) {
					if(localStorage.caiweiWx) {
						var caiweiWx = JSON.parse(localStorage.caiweiWx);
						if(caiweiWx.cat=="10"){
							$("#idcardlabel").text("身份认证");
						}else{
                            $("#idcardlabel").text("我的银行卡");
						}
						wxLogin(caiweiWx);
					} else {
						error("微信授权过期，请重新登录");
					}
				} else {
					localStorage.caiweicode = code;
					getCheckWxUser();
				}
			});


            function showCustomerModal() {
                $("#telPhone").load("tel.html");
            }

            function initCustomerModal() {
                if(!customerPhone){
                    setTimeout(function(){
                        postSerDataWithHeader('/wechat/user/api/querySysConfig.shtml', {
                            "code": "service_phone"
                        }, function (data) {
                            if(data&&data.success&&data.data.value){
                                customerPhone=data.data.value;
                                localStorage.mineTelPhone=customerPhone;
                            }

                        }, '查询客服电话');
                    },200);
                }
            }
            function closeCustomerModal() {
                $("#telPhone").empty();
            }
            function error(msg){
                $("body").append('<div class="error"><span class="error_msg"></span></div>');
                $(".error").show();
                $(".error_msg").html(msg);
                setTimeout(function(){
                    $(".error").remove();
                },1500);
            }
		</script>
	</body>

</html>